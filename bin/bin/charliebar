#!/bin/sh
# my bar!
#
# deps:
#  - lemonbar
#
# charlie - (c) 2015

if hash acpi 2>/dev/null; then
    LAPTOP=true
else
    LAPTOP=false
fi

default_geometry() {
    # get screen size
    x=$(wattr w `lsw -r`)
    y=$(wattr h `lsw -r`)

    width=160
    height=20

    offy=0 #$(($y - $height))
    offx=$(( x - $width ))

    echo "${width}x${height}+${offx}+${offy}"
}

lemoncommand() {
    lemonbar -d -g `default_geometry` -B '#000' -F'#AAA' \
        -f "-*-tewi-medium-*-*--*-*-*-*-*-*-*-*"
}

while true
do
    TIME=`date "+%H:%M %-m/%-d"`
    if $LAPTOP; then
        BAT="bat $(progbar $(acpi -b | cut -d',' -f2 | tr -d ' %'))"
        echo " %{l}$BAT%{r}$TIME "
    else
        echo "%{c}$TIME"
    fi
    sleep 60
done | lemoncommand

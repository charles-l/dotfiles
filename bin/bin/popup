#!/bin/sh
#
# z3bra - (c) wtfpl 2014
# Create a small popup with the given text
#
# depends: lemonbar, wattr and common sense

# bar options
font='-*-tewi-medium-*-*-*-*-*-*-*-*-*-*-*'
bg="#CCC"
fg="#333"
hl="#ff443232"

default_geometry() {
    # get screen size
    x=$(wattr w `lsw -r`)
    y=$(wattr h `lsw -r`)

    width=250
    height=40

    offy=20
    offx=$(( x - width - 20))

    echo "${width}x${height}+${offx}+${offy}"
}

while getopts "c:d:g:h" opt; do
    case $opt in
        d) SLEEP=$OPTARG   ;;
        g) GEOM=$OPTARG    ;;
        h) usage; exit 0   ;;
        c) COMMAND=$OPTARG ;;
    esac
done

GEOM=${GEOM:-$(default_geometry)}
SLEEP=${SLEEP:-5}

if [ -t 0 ]; then
    CONTENT=$@
else
    CONTENT=$(cat)
fi

str="$CONTENT"

if [ ! -z "$COMMAND" ]; then
    str="%{A:$COMMAND:}$str%{A}"
fi

str="%{c}$str"

(echo $str; sleep $SLEEP) | lemonbar -d -g $GEOM -B $bg -F $fg -f $font | sh &

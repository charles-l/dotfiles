#!/bin/sh
# stupid wifi wrapper, 'cause I need to restart it often... :(
# WARNING: crap! DO NOT USE!

DEV=`ip link | cut -d' ' -f 2 | cut -d':' -f 1 | grep -v '^$' | grep enp`
DEV=wlp2s0u1u1
DEV=enp2s0u1u1

function doconnect() {
    ip link set $DEV up
    iwlist $DEV scan | grep -B 1 "ESSID:"

    wpa_supplicant -B -Dwext -i $DEV -c /etc/wpa_supplicant/wpa_supplicant.conf
    sleep 2
    dhcpcd $DEV
}

function dokill() {
    ip link set $DEV down
    killall wpa_supplicant
    killall dhcpcd
    ip addr flush dev $DEV
}

case $1 in
    connect)
        doconnect
        ;;
    kill)
        dokill
        ;;
    *)
        echo "USAGE: `basename $0` connect"
        echo "       `basename $0` kill"
        ;;
esac
